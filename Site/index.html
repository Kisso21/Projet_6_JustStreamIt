<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>JustStreamIt</title>
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <header>
        <h1>JUST STREAM IT Vidéo à la demande</h1>
    </header>
    <main>     
            <div>
                <h2>Meilleur film</h2>
                <div id="bestFilm">
                </div>
            </div>
            <div>
                <h2>Films les mieux notés</h2>
                <div id ="topSix" class="topFilmMain">
                </div>
            </div>
            <div>
                <h2>Comédie</h2>
                <div id ="topComedy" class="topFilmMain">
                </div>
            </div>
            <div>
                <h2>Science-Fiction</h2>
                <div id ="topSciFi" class="topFilmMain">
                </div>
            </div>
            <div>
                <h2 for="genre">Choisissez un genre :</h2>
                    <select id="genre">
                    <!-- Options seront ajoutées ici par JavaScript -->
                    </select>
                    <div id ="topGenre" class="topFilmMain">
                    </div>
            </div>
    </main>
    <script>
        /* Récupération des film les mieux notés toutes catégories confondu */
        
        fetch('http://localhost:8000/api/v1/titles/?year=&min_year=&page_size=7&max_year=&imdb_score=&imdb_score_min=&imdb_score_max=&title=&title_contains=&genre=&genre_contains=&sort_by=-imdb_score&director=&director_contains=&writer=&writer_contains=&actor=&actor_contains=&country=&country_contains=&lang=&lang_contains=&company=&company_contains=&rating=&rating_contains=')
    .then(response => response.json())
    .then(data => {
        const firstFilm = data.results[0];
        const firstFilmDiv = document.getElementById('bestFilm');
        const filmTopSix = document.getElementById('topSix');
        
        firstFilmDiv.innerHTML = `
            <h3>${firstFilm.title} (${firstFilm.year})</h3>
            <img src="${firstFilm.image_url}" alt="${firstFilm.title}">
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            <button id="myBtn" data-content="${JSON.stringify(firstFilm)}">Details</button>
        `;
        
        // Bouton pour ouvrir la modal
        const myBtn = document.getElementById('myBtn');

        myBtn.onclick = function() {
            const modal = document.createElement('div');
            modal.id = `myModalFirst`; // Un identifiant unique pour chaque modal
            modal.classList.add('modal');
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <p class="modalTitle">${firstFilm.title}</p>
                    <img src="${firstFilm.image_url}" alt="${firstFilm.title}">
                    <p>Année: ${firstFilm.year} - ${firstFilm.genres} </p>
                    <p>IMDB score: ${firstFilm.imdb_score} /10</p>
                    <p>Réalisé par : 
                    ${firstFilm.directors}</p>
                    <p>IMDB score: ${firstFilm.imdb_score} /10</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                    <p>Avec: ${firstFilm.actors.join(', ')}</p>
                </div>
            `;
            document.body.appendChild(modal);
            modal.style.display = "block";

            // Fermer la modal lorsque l'utilisateur clique sur la croix
            const closeBtn = modal.querySelector('.close');
            closeBtn.onclick = function() {
                modal.style.display = "none";
            }
        };

        for (let i = 1; i < 7; i++) {
            const film = data.results[i];
            const filmDiv = document.createElement('div');
            filmDiv.classList.add('film');
            filmDiv.innerHTML = `
                <img src="${film.image_url}" alt="${film.title}">
            `;
            // Get the button that opens the modal
            var btn = document.createElement("button");
            btn.setAttribute("data-content", JSON.stringify(film)); // Convertir l'objet film en chaîne JSON
            btn.innerHTML = "Details";

            // When the user clicks on the button, open the modal 
            btn.onclick = function() {
                const modal = document.createElement('div');
                modal.id = `myModal${i}`; // Un identifiant unique pour chaque modal
                modal.classList.add('modal');
                modal.innerHTML = `
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <p>Titre du film : ${film.title}</p>
                        <img src="${film.image_url}" alt="${film.title}">
                        <p>Année: ${film.year} - ${film.genres} </p>
                        <p>Réalisateur: ${film.directors}</p>
                        <p>IMDB score: ${film.imdb_score} /10</p>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                        <p>Avec: ${film.actors.join(', ')}</p>
                    </div>
                `;
                document.body.appendChild(modal);
                modal.style.display = "block";

                // Fermer la modal lorsque l'utilisateur clique sur la croix
                const closeBtn = modal.querySelector('.close');
                closeBtn.onclick = function() {
                    modal.style.display = "none";
                }
            }
            filmDiv.appendChild(btn)
            filmTopSix.appendChild(filmDiv);
        }
    })
    .catch(error => {
        console.error('Une erreur s\'est produite lors de la récupération des données :', error);
    });
        /* Récupération des film les mieux notés Comedy */
        var responsetojson = (response) => response.json();   
        fetch('http://localhost:8000/api/v1/titles/?year=&min_year=&page_size=6&max_year=&imdb_score=&imdb_score_min=&imdb_score_max=&title=&title_contains=&genre=&genre_contains=comedy&sort_by=-imdb_score&director=&director_contains=&writer=&writer_contains=&actor=&actor_contains=&country=&country_contains=&lang=&lang_contains=&company=&company_contains=&rating=&rating_contains=')
            .then(response => response.json())
            .then(data => {
                const filmTopComedy = document.getElementById('topComedy');
                for (let i = 0; i < 6; i++) {
                    const film = data.results[i];
                    const filmDiv = document.createElement('div');
                    filmDiv.classList.add('film');
                    filmDiv.innerHTML = `
                        <img src="${film.image_url}" alt="${film.title}">
                    `;
                    // Get the button that opens the modal
                    var btn = document.createElement("button");
                    btn.setAttribute("data-content", JSON.stringify(film)); // Convertir l'objet film en chaîne JSON
                    btn.innerHTML = "Details";

                    // When the user clicks on the button, open the modal 
                    btn.onclick = function() {
                    const modal = document.createElement('div');
                    modal.id = `myModal${i}`; // Un identifiant unique pour chaque modal
                    modal.classList.add('modal');
                    modal.innerHTML = `
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <p>Titre du film : ${film.title}</p>
                            <img src="${film.image_url}" alt="${film.title}">
                            <p>Année: ${film.year} - ${film.genres} </p>
                            <p>Réalisateur: ${film.directors}</p>
                            <p>IMDB score: ${film.imdb_score} /10</p>
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                            <p>Avec: ${film.actors.join(', ')}</p>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    modal.style.display = "block";

                    // Fermer la modal lorsque l'utilisateur clique sur la croix
                    const closeBtn = modal.querySelector('.close');
                    closeBtn.onclick = function() {
                        modal.style.display = "none";
                    }
                    }
                    filmDiv.appendChild(btn)
                    filmTopComedy.appendChild(filmDiv);
                }
            })
            .catch(error => {
                console.error('Une erreur s\'est produite lors de la récupération des données :', error);
            });
            /* Récupération des film les mieux notés Sci-Fi */
        fetch('http://localhost:8000/api/v1/titles/?year=&min_year=&page_size=6&max_year=&imdb_score=&imdb_score_min=&imdb_score_max=&title=&title_contains=&genre=&genre_contains=Sci-Fi&sort_by=-imdb_score&director=&director_contains=&writer=&writer_contains=&actor=&actor_contains=&country=&country_contains=&lang=&lang_contains=&company=&company_contains=&rating=&rating_contains=')
            .then(response => response.json())
            .then(data => {
                const filmTopSciFi = document.getElementById('topSciFi');
                for (let i = 0; i < 6; i++) {
                    const film = data.results[i];
                    const filmDiv = document.createElement('div');
                    filmDiv.classList.add('film');
                    filmDiv.innerHTML = `
                        <img src="${film.image_url}" alt="${film.title}">
                    `;
                    // Get the button that opens the modal
                    var btn = document.createElement("button");
                    btn.setAttribute("data-content", JSON.stringify(film)); // Convertir l'objet film en chaîne JSON
                    btn.innerHTML = "Details";

                    // When the user clicks on the button, open the modal 
                    btn.onclick = function() {
                        const modal = document.createElement('div');
                        modal.id = `myModal${i}`; // Un identifiant unique pour chaque modal
                        modal.classList.add('modal');
                        modal.innerHTML = `
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <p>Titre du film : ${film.title}</p>
                                <img src="${film.image_url}" alt="${film.title}">
                                <p>Année: ${film.year} - ${film.genres} </p>
                                <p>Réalisateur: ${film.directors}</p>
                                <p>IMDB score: ${film.imdb_score} /10</p>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                                <p>Avec: ${film.actors.join(', ')}</p>
                            </div>
                        `;
                        document.body.appendChild(modal);
                        modal.style.display = "block";

                        // Fermer la modal lorsque l'utilisateur clique sur la croix
                        const closeBtn = modal.querySelector('.close');
                        closeBtn.onclick = function() {
                            modal.style.display = "none";
                        }
                    }
                    filmDiv.appendChild(btn)
                    filmTopSciFi.appendChild(filmDiv);
                }
            })
            .catch(error => {
                console.error('Une erreur s\'est produite lors de la récupération des données :', error);
            });
        fetch('http://localhost:8000/api/v1/genres/?page_size=30')
            .then(response => response.json())
            .then(data => {
                const genreSelect = document.getElementById('genre');
                data.results.forEach(genre => {
                const option = document.createElement('option');
                option.value = genre.id; // Valeur de l'option est l'ID du genre
                option.textContent = genre.name; // Texte de l'option est le nom du genre
                genreSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Erreur lors de la récupération des genres :', error);
            });
    </script>
    <script>
const selectElement = document.getElementById('genre');

selectElement.addEventListener('change', function() {
    const selectedOption = selectElement.options[selectElement.selectedIndex].textContent;
    const url = `http://localhost:8000/api/v1/titles/?genre=${selectedOption}&sort_by=-imdb_score&page_size=6`;
    fetch(url)
    .then(response => response.json())
    .then(data => {
        console.log('Résultat de la requête :', data);
        const filmTopGenre = document.getElementById('topGenre');
        filmTopGenre.innerHTML=""
                for (let i = 0; i < 6; i++) {
                    const film = data.results[i];
                    const filmDiv = document.createElement('div');
                    filmDiv.classList.add('film');
                    filmDiv.innerHTML = `
                        <img src="${film.image_url}" alt="${film.title}">
                    `;
                    // Get the button that opens the modal
                    var btn = document.createElement("button");
                    btn.setAttribute("data-content", JSON.stringify(film)); // Convertir l'objet film en chaîne JSON
                    btn.innerHTML = "Details";

                    // When the user clicks on the button, open the modal 
                    btn.onclick = function() {
                    const modal = document.createElement('div');
                    modal.id = `myModal${i}`; // Un identifiant unique pour chaque modal
                    modal.classList.add('modal');
                    modal.innerHTML = `
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <p>Titre du film : ${film.title}</p>
                            <img src="${film.image_url}" alt="${film.title}">
                            <p>Année: ${film.year} - ${film.genres} </p>
                            <p>Réalisateur: ${film.directors}</p>
                            <p>IMDB score: ${film.imdb_score} /10</p>
                            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
                            <p>Avec: ${film.actors.join(', ')}</p>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    modal.style.display = "block";

                    // Fermer la modal lorsque l'utilisateur clique sur la croix
                    const closeBtn = modal.querySelector('.close');
                    closeBtn.onclick = function() {
                        modal.style.display = "none";
                    }
                    }
                    filmDiv.appendChild(btn)
                    filmTopGenre.appendChild(filmDiv);
                }
                
        // Faire quelque chose avec les données récupérées
    })
    .catch(error => console.error('Erreur lors de la requête :', error));
});


    </script>
</body>
</html>